<div class="flex h-screen overflow-visible">
  <app-sidenav-ws class="relative z-20"></app-sidenav-ws>

  <!-- Main content -->
  <div class="flex-1 flex flex-col overflow-visible">
    <app-header-ws class="relative z-0"></app-header-ws>

    <!-- Page Content -->
    <main class="flex-1 overflow-y-auto p-6 relative">
      <!-- SPINNER de carga fullscreen -->
      <div
        *ngIf="loading"
        class="absolute inset-0 z-[9998] bg-white/40 backdrop-blur-md flex flex-col items-center justify-center transition-opacity duration-300"
      >
        <div
          class="w-12 h-12 border-4 border-sky-500 border-t-transparent rounded-full animate-spin"
        ></div>
        <p
          class="mt-4 text-sky-600 font-semibold text-lg animate-pulse tracking-wide"
        >
          Cargando visualización...
        </p>
      </div>

      <!-- CONTENIDO -->
      <div
        class="p-6 bg-white border border-sky-200 rounded-lg shadow-lg relative z-10"
      >
        <h2 class="text-xl font-semibold text-sky-600 mb-4 text-center">
          Comparación Visual entre Segmentación Automática y Manual
        </h2>

        <div *ngIf="error" class="text-red-500 text-center mb-4">
          {{ error }}
        </div>

        <div *ngIf="comparisonUrl && !loading" class="flex gap-4">
          <!-- Visualización (izquierda) -->
          <!-- Selects modernizados -->
          <div class="grid items-center gap-0 mb-4">
            <div class="flex flex-col">
              <label class="text-sm font-medium text-gray-700 mb-1"
                >Modalidad</label
              >
              <select
                [(ngModel)]="modality"
                (change)="loadComparison()"
                class="border border-gray-300 focus:outline-1 focus:outline-sky-100 rounded px-3 py-2 text-sm text-gray-700"
              >
                <option value="flair">FLAIR</option>
                <option value="t1c">T1c</option>
              </select>
            </div>

            <div class="flex flex-col">
              <label class="text-sm font-medium text-gray-700 mb-1"
                >Orientación</label
              >
              <select
                [(ngModel)]="orientation"
                (change)="loadComparison()"
                class="border border-gray-300 focus:outline-1 focus:outline-sky-100 rounded px-3 py-2 text-sm text-gray-700"
              >
                <option value="axial">Axial</option>
                <option value="coronal">Coronal</option>
                <option value="sagittal">Sagital</option>
              </select>
            </div>
          </div>

          <div class="w-3/4">
            <iframe
              [src]="comparisonUrl"
              width="100%"
              height="650"
              class="border rounded-lg shadow"
            ></iframe>
          </div>

          <!-- Formulario (derecha) -->
          <div
            class="w-1/4 border border-gray-300 rounded-lg p-4 shadow bg-gray-50"
          >
            <h3 class="text-lg font-semibold text-gray-700 mb-4 text-center">
              Diagnóstico presuntivo
            </h3>

            <form (ngSubmit)="submitDiagnosis()" class="space-y-4">
              <div>
                <label class="block mb-1 text-sm text-gray-700 ">
                  ¿Es adecuada la segmentación?
                </label>
                <select
                  [(ngModel)]="diagnosticOk"
                  name="diagnosticOk"
                  class="w-full border rounded p-2  border-gray-300"
                  required
                >
                  <option value="" disabled selected>Seleccione</option>
                  <option value="Sí">Sí</option>
                  <option value="Neutro">Neutro</option>
                  <option value="No">No</option>
                </select>
              </div>

              <div>
                <label class="block mb-1 text-sm text-gray-700">
                  Observaciones
                </label>
                <textarea
                  [(ngModel)]="observations"
                  name="observations"
                  class="w-full border border-gray-300 focus:outline-1 focus:outline-sky-100 rounded p-2 h-28 max-h-70 min-h-20 resize-y text-sm text-gray-700 placeholder-gray-400"
                  spellcheck="false"
                  autocomplete="off"
                  autocorrect="off"
                  placeholder="Escribe tus observaciones aquí..."
                  required
                ></textarea>
              </div>

              <button
                type="submit"
                class="bg-sky-600 text-white w-full py-2 rounded hover:bg-sky-700 transition"
              >
                Enviar
              </button>
            </form>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>
